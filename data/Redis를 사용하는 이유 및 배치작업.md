# Redis를 사용하는 이유 및 배치작업(전직시)

[레디스Redis가 뭐에요? 레디스 설치하기, 레디스 튜토리얼](https://sihyung92.oopy.io/database/redis/1)

1. **빠른 속도**: Redis는 메모리 기반의 데이터 저장소로, 디스크 기반의 데이터베이스보다 매우 빠른 읽기/쓰기 성능을 제공합니다. 공공 데이터 포털 API와 같은 외부 API의 응답이 느릴 때, Redis를 사용하면 자주 조회되는 데이터를 캐시하여 응답 속도를 대폭 개선할 수 있습니다.
2. **캐싱 용이성**: Redis는 간단한 키-값 저장소 구조를 제공하여, API 응답 결과나 자주 조회되는 데이터를 메모리에 저장하고, 이후에 빠르게 조회할 수 있습니다. 이렇게 하면 반복적인 API 호출 없이 캐시된 데이터를 바로 사용할 수 있어 성능을 크게 개선할 수 있습니다.
3. **비동기 처리와의 결합**: Redis는 비동기적으로 데이터를 저장하고 읽을 수 있어, 대량의 데이터를 처리할 때 다른 프로세스나 요청을 차단하지 않고 동시에 여러 작업을 처리할 수 있습니다. 비동기 처리와 Redis 캐싱을 결합하면 더 높은 성능을 유지하면서 서버의 부하를 줄일 수 있습니다.
4. **데이터 만료 및 자동 삭제**: Redis는 TTL(Time-To-Live) 기능을 제공하여, 일정 시간이 지난 데이터를 자동으로 삭제할 수 있습니다. 이를 활용해 오래된 데이터를 자동으로 갱신하거나 삭제하면서 캐시를 관리할 수 있습니다.

그러나 Redis 외에도 다른 대안이 있을 수 있습니다. 예를 들어:

- **Memcached**: 메모리 기반 캐싱 시스템으로, Redis와 유사한 기능을 제공하지만 데이터 구조나 기능 면에서 Redis보다 간단하고 빠릅니다. Redis보다 더 가벼운 캐싱이 필요할 때 사용할 수 있습니다.
- **데이터베이스 쿼리 최적화**: 만약 API에서 응답이 느린 이유가 데이터베이스 쿼리 자체에 있다면, 쿼리 최적화를 통해 성능을 개선할 수 있습니다. 예를 들어, 인덱스를 추가하거나 쿼리 구조를 개선하여 응답 시간을 단축할 수 있습니다.
- **API 게이트웨이**: API 응답이 느리다면, API 게이트웨이를 활용해 데이터를 미리 캐시하거나, 여러 개의 요청을 배치 처리하여 효율성을 높일 수 있습니다.

---

배치 작업(Batch Job)은 여러 개의 작업을 하나의 그룹으로 묶어서 일정 시간 동안 일괄적으로 처리하는 방식입니다. 주로 **자동화된 데이터 처리**나 **대량 데이터 처리**에 사용되며, 사용자 요청에 직접 응답하지 않고 **백그라운드에서 주기적으로** 또는 **지정된 시간에** 실행되는 작업을 말합니다.

### 배치 작업의 특징:

1. **대량 데이터 처리**: 사용자의 요청에 따라 처리되는 것이 아니라, 미리 정의된 대량의 데이터를 한 번에 처리하는 방식입니다. 예를 들어, 하루에 한 번씩 모든 사용자의 거래 기록을 처리하는 경우가 있을 수 있습니다.
2. **비동기적 실행**: 배치 작업은 사용자 요청과는 독립적으로 백그라운드에서 실행되며, 이를 통해 서버의 응답 시간에 영향을 주지 않고 데이터 처리 작업을 할 수 있습니다.
3. **정기적 실행**: 배치 작업은 주로 정해진 일정에 따라 자동으로 실행되며, 예를 들어 **매일**, **매주**, **매월** 등 특정 시간대에 데이터를 처리합니다.
4. **효율적인 리소스 사용**: 배치 작업은 사용자가 많이 몰리지 않은 시간대에 실행되기 때문에, 시스템의 리소스를 효율적으로 사용할 수 있습니다.

### 배치 작업 예시:

- **데이터 백업**: 일정한 시간 간격으로 데이터베이스를 백업하여, 시스템에 문제가 생겼을 때 복구할 수 있도록 합니다.
- **로그 분석**: 서버 로그를 일정 주기마다 분석하여, 분석 결과를 보고서로 생성하거나 경고를 보내는 작업.
- **대량 이메일 발송**: 예를 들어, 뉴스레터나 마케팅 이메일을 대량으로 발송하는 작업.
- **데이터 정리 및 처리**: 대량의 데이터를 처리하거나, 오래된 데이터를 삭제하거나 업데이트하는 작업. 예를 들어, 매일 자정마다 특정 데이터를 정리하거나 갱신하는 작업.

### 배치 작업의 장점:

- **성능 최적화**: 사용자 요청을 기다리면서 대량 데이터를 처리하지 않고, 백그라운드에서 실행하여 성능을 최적화할 수 있습니다.
- **시간과 리소스 관리**: 비즈니스에 맞춰 처리 작업을 자동화할 수 있고, 리소스를 효율적으로 사용할 수 있습니다.
- **에러 처리**: 배치 작업은 주기적으로 실행되므로, 오류가 발생할 경우 빠르게 다시 시도하거나 알림을 보낼 수 있습니다.

배치 작업은 특히 **대규모 데이터 처리**가 필요한 시스템이나 **시간 민감성이 덜한 작업**에 유용하게 활용됩니다.

배치 작업을 구현하는 방법은 여러 가지가 있으며, 사용하는 기술 스택과 요구사항에 따라 적합한 방법을 선택할 수 있습니다. 배치 작업을 실행하려면 **주기적으로 또는 일괄적으로 데이터를 처리**하는 시스템을 설정하고, 이를 자동화하는 방법을 사용해야 합니다. 여기서는 일반적인 배치 작업을 구현하는 방법과 자주 사용되는 도구들에 대해 설명하겠습니다.

### 1. **스케줄러 사용 (Cron, Quartz 등)**

배치 작업을 주기적으로 실행하려면 **스케줄러**를 사용해야 합니다. 스케줄러는 특정 시간 간격으로 배치 작업을 실행하도록 예약하는 도구입니다.

- **Cron** (리눅스, 유닉스 계열 시스템에서 사용):
Cron은 **리눅스**에서 주기적으로 실행되는 작업을 설정하는 도구입니다. Cron을 사용하면 특정 시간이나 날짜에 배치 작업을 자동으로 실행할 수 있습니다.
    
    예를 들어, 매일 자정에 배치 작업을 실행하려면:
    
    ```bash
    0 0 * * * /path/to/your/script.sh
    
    ```
    
- **Quartz** (Java 기반 스케줄러):
Quartz는 **Java** 기반으로 배치 작업을 관리하는 강력한 스케줄러입니다. 주기적으로 작업을 실행하거나 특정 조건에서 실행할 수 있는 기능을 제공합니다.
Quartz는 스프링 프레임워크와 쉽게 통합할 수 있어 스프링 프로젝트에서 많이 사용됩니다.

### 2. **프레임워크 및 라이브러리 활용**

배치 작업을 효율적으로 관리하려면 배치 처리에 특화된 **프레임워크**를 사용하는 것이 좋습니다. 이런 프레임워크는 작업의 실행, 오류 처리, 상태 관리 등을 더 쉽게 관리할 수 있게 해줍니다.

- **Spring Batch** (Java):
Spring Batch는 **대규모 데이터 처리**를 위한 프레임워크로, 주로 **Java**로 배치 작업을 구현할 때 사용됩니다. 대량 데이터 처리, 상태 관리, 트랜잭션 처리 등의 기능을 제공합니다.
    
    예를 들어, `ItemReader`와 `ItemProcessor`, `ItemWriter`를 사용하여 데이터를 읽고 처리하고 쓰는 일련의 작업을 구성할 수 있습니다.
    
    ```java
    @Configuration
    public class BatchConfig {
    
        @Bean
        public Job processJob(JobBuilderFactory jobBuilderFactory, StepBuilderFactory stepBuilderFactory) {
            return jobBuilderFactory.get("processJob")
                .start(processStep(stepBuilderFactory))
                .build();
        }
    
        @Bean
        public Step processStep(StepBuilderFactory stepBuilderFactory) {
            return stepBuilderFactory.get("processStep")
                .<InputType, OutputType>chunk(10)
                .reader(reader())
                .processor(processor())
                .writer(writer())
                .build();
        }
    
        @Bean
        public ItemReader<InputType> reader() {
            return new CustomReader();
        }
    
        @Bean
        public ItemProcessor<InputType, OutputType> processor() {
            return new CustomProcessor();
        }
    
        @Bean
        public ItemWriter<OutputType> writer() {
            return new CustomWriter();
        }
    }
    
    ```
    
- **Celery** (Python):
Celery는 **Python**에서 사용하는 비동기 작업 큐로, 백그라운드 작업을 주기적으로 또는 일정 시간에 실행할 수 있게 해줍니다. Celery를 사용하면 분산 처리도 가능하고, 실패 시 재시도와 같은 고급 기능도 지원합니다.
    
    예를 들어, Celery를 사용한 간단한 배치 작업 예시:
    
    ```python
    from celery import Celery
    
    app = Celery('tasks', broker='pyamqp://guest@localhost//')
    
    @app.task
    def process_data(data):
        # 데이터 처리 로직
        return result
    
    ```
    

### 3. **배치 작업을 위한 데이터베이스 작업 최적화**

배치 작업에서 대량 데이터를 처리할 때 **데이터베이스**를 효율적으로 다루는 것이 중요합니다. 일반적으로 SQL을 이용한 **배치 업데이트**나 **배치 삽입**을 할 때, 하나의 트랜잭션 내에서 여러 개의 레코드를 처리하는 방식으로 효율적으로 데이터베이스 성능을 최적화할 수 있습니다.

- **Batch Insert**: 여러 개의 데이터를 한 번에 삽입하는 방법. 예를 들어, SQL에서 `INSERT INTO table (col1, col2) VALUES (val1, val2), (val3, val4)`와 같은 형태로 한번에 여러 개의 값을 삽입할 수 있습니다.
- **Batch Update**: 대량 데이터를 한번에 업데이트하는 방법. 예를 들어, `UPDATE table SET col1 = val1 WHERE col2 = val2`와 같은 쿼리를 반복적으로 실행하는 방식입니다.

### 4. **클라우드 서비스 이용 (AWS Lambda, Azure Functions)**

최근에는 클라우드 서비스를 이용해 배치 작업을 구현하는 방법도 많이 사용됩니다. 클라우드에서는 서버를 직접 관리하지 않고, 필요한 리소스를 자동으로 할당해주는 서비스를 제공합니다.

- **AWS Lambda**: 이벤트 기반으로 서버리스 방식에서 배치 작업을 실행할 수 있습니다. 예를 들어, 특정 이벤트(파일 업로드, 데이터베이스 변화 등)에 따라 배치 작업을 자동으로 실행할 수 있습니다.
- **Azure Functions**: Azure에서 제공하는 서버리스 컴퓨팅 서비스를 이용하여 일정 주기로 작업을 실행하거나, 이벤트에 반응하여 배치 작업을 실행할 수 있습니다.

### 5. **배치 작업 모니터링 및 로깅**

배치 작업은 주로 백그라운드에서 실행되므로, 작업의 진행 상황과 결과를 모니터링하고 기록하는 것이 중요합니다. 배치 작업이 정상적으로 실행되었는지, 실패했는지, 언제 실행되었는지 등을 로깅하여 추후 문제를 추적하고 해결할 수 있도록 해야 합니다.

- **로그 기록**: 배치 작업 실행 중 발생한 오류나 진행 상황을 로그 파일에 기록하여 추후에 검토할 수 있도록 합니다.
- **모니터링 도구 사용**: 배치 작업을 실행하는 시스템에 대해 **모니터링 도구**를 사용하여 작업의 상태나 성능을 모니터링할 수 있습니다. 예를 들어, **Prometheus**, **Grafana**와 같은 도구를 사용하여 배치 작업의 성능과 상태를 시각화할 수 있습니다.

### 배치 작업 구현을 위한 도구 요약

- **Cron**: 리눅스에서 간단한 배치 작업을 주기적으로 실행.
- **Quartz**: Java 기반의 고급 배치 스케줄러.
- **Spring Batch**: 대규모 데이터 처리에 최적화된 Java 배치 처리 프레임워크.
- **Celery**: Python에서 비동기 작업 큐를 통한 배치 작업 처리.
- **AWS Lambda/Azure Functions**: 서버리스 클라우드 환경에서 배치 작업 처리.

배치 작업은 데이터 처리 효율성을 높이고, 시스템 부하를 분산시키며, 대량 데이터를 자동으로 처리하는 데 유용한 방법입니다.